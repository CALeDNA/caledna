<%= javascript_pack_tag 'ebbe_nielsen/pp_charts' %>
<style>
  canvas {
    margin-bottom: 2rem;
  }
</style>

<h2>GBIF Unique Species Breakdown</h2>

<div class="row">
  <div class="col-sm-6">
    <h3>All GBIF Occurrences</h3>
    <%= render partial: "beta/ebbe_nielsen/occurrence_table",
      locals: {
        occurrence_stats: EbbeNielsenHelper.only_gbif_counts(@gbif_breakdown[:all]),
        total: EbbeNielsenHelper.total(@gbif_breakdown[:all].values)
      } %>
  </div>
</div>

<div class="row">
  <div class="col-sm-6">
    <h3>iNaturalist Observations</h3>
    <canvas id="only-inat-chart" width="400" height="400"></canvas>

    <%= render partial: "beta/ebbe_nielsen/occurrence_table",
      locals: {
        occurrence_stats: EbbeNielsenHelper.only_gbif_counts(@gbif_breakdown[:inat_only]),
        total: EbbeNielsenHelper.total(@gbif_breakdown[:inat_only].values)
      } %>
  </div>

  <div class="col-sm-6">
    <h3>Exclude iNaturalist Observations</h3>
    <canvas id="exclude-inat-chart" width="400" height="400"></canvas>

    <%= render partial: "beta/ebbe_nielsen/occurrence_table",
      locals: {
        occurrence_stats: EbbeNielsenHelper.only_gbif_counts(@gbif_breakdown[:exclude_inat]),
        total: EbbeNielsenHelper.total(@gbif_breakdown[:exclude_inat].values)
      } %>
  </div>
</div>

<script>
(function(){

  window.caledna = {
    only_inat_data: <%= @gbif_breakdown[:inat_only].to_json.html_safe %>,
    exclude_inat_data: <%= @gbif_breakdown[:exclude_inat].to_json.html_safe %>
  }

})(window)
</script>
