<table class="table">
  <tr>
    <td>Field Data Project</td>
    <td><%= link_to sample.field_data_project.name, field_data_project_path(sample.field_data_project) %></td>
  </tr>
  <tr>
    <td>Research Projects</td>
    <td>
      <% sample.research_projects.each do |project| %>
        <%= link_to project.name, research_project_path(project) %>
      <% end %>
    </td>
  </tr>
  <tr>
    <td>Barcode</td>
    <td><%= sample.barcode %></td>
  </tr>
  <tr>
    <td>Lat/Long</td>
    <td>
      <%= sample.latitude %>, <%= sample.longitude %>
    </td>
  </tr>
  <tr>
    <td>GPS Precision</td>
    <td>
      <%= sample.gps_precision %>
    </td>
  </tr>
  <tr>
    <td>Location</td>
    <td><%= sample.location %></td>
  </tr>
  <tr>
    <td>Field Notes</td>
    <td>
      <%= sample.field_notes %>
    </td>
  </tr>
  <tr>
    <td>Status</td>
    <td><%= sample.status_display %></td>
  </tr>
  <tr>
    <td>Collection Date</td>
    <td><%= long_date(sample.submission_date) %></td>
  </tr>

  <% sample.extractions.each do |extraction| %>
    <% if sample.extractions.length > 1%>
      <tr>
        <td><b><%= extraction.extraction_type.name %></b></td>
        <td></td>
      </tr>
    <% end %>
    <tr>
      <td>Analysis Date</td>
      <td><%= long_date(extraction.stat_dna_extraction_date) %></td>
    </tr>
    <tr>
      <td>DNA Results Completed Date</td>
      <td><%= long_date(extraction.stat_dna_extraction_date) %></td>
    </tr>
  <% end %>
</table>

<div class="row">
  <div class="col col-md-6">
    <% if SamplesHelper.asvs_count(@asvs_count, @sample).present? %>
      <h3><%= SamplesHelper.asvs_count(@asvs_count, @sample) %> Organisms from ASVs</h3>

      <% @sample.extractions.each do |extraction| %>
        <canvas id="kingdom-chart-<%= extraction.id %>" width="400" height="400"></canvas>
      <% end %>
    <% end %>
  </div>
  <div class="col col-md-6">
  </div>
</div>


<div class="row">
  <div class="col col-md-6">
    <h3>Map</h3>
    <%= render partial: "samples/map", locals: { samples: [sample],
      asvs_count: @asvs_count,
      initial_lat: sample.latitude, initial_lng: sample.longitude } %>
  </div>
  <div class="col col-md-6">
    <h3>Site Photos</h3>
    <% if sample.photos.present? %>
      <%= render partial: "samples/gallery", locals: { photos: sample.photos } %>
    <% else %>
      <%= image_tag 'blank_photo.svg' %>
    <% end %>
  </div>
</div>

<script>
(function(){

  var counts = []
  <% @sample.extractions.each do |extraction| %>
    counts.push({
      id: <%= extraction.id %>,
      counts: <%=  SamplesHelper.kingdom_count(@sample.extractions.first.asvs).to_json.html_safe %>
    })
  <% end %>

  window.caledna = {
    kingdom_counts: counts
  }

})(window)
</script>
