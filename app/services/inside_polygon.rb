module InsidePolygon

  CALIFORNIA = [
    [41.9983, -124.4009],
    [42.0024, -123.6237],
    [42.0126, -123.1526],
    [42.0075, -122.0073],
    [41.9962, -121.2369],
    [41.9983, -119.9982],
    [39.0021, -120.0037],
    [37.5555, -117.9575],
    [36.3594, -116.3699],
    [35.0075, -114.6368],
    [34.9659, -114.6382],
    [34.9107, -114.6286],
    [34.8758, -114.6382],
    [34.8454, -114.597],
    [34.789, -114.5682],
    [34.7269, -114.4968],
    [34.6648, -114.4501],
    [34.6581, -114.4597],
    [34.5869, -114.4322],
    [34.5235, -114.3787],
    [34.4601, -114.3869],
    [34.45, -114.3361],
    [34.4375, -114.3031],
    [34.4024, -114.2674],
    [34.3559, -114.1864],
    [34.3049, -114.1383],
    [34.2561, -114.1315],
    [34.2595, -114.1651],
    [34.2044, -114.2249],
    [34.1914, -114.2221],
    [34.172, -114.2908],
    [34.1368, -114.3237],
    [34.1186, -114.3622],
    [34.1118, -114.4089],
    [34.0856, -114.4363],
    [34.0276, -114.4336],
    [34.0117, -114.4652],
    [33.9582, -114.5119],
    [33.9308, -114.5366],
    [33.9058, -114.5091],
    [33.8613, -114.5256],
    [33.8248, -114.5215],
    [33.7597, -114.505],
    [33.7083, -114.494],
    [33.6832, -114.5284],
    [33.6363, -114.5242],
    [33.5895, -114.5393],
    [33.5528, -114.5242],
    [33.5311, -114.5586],
    [33.507, -114.5778],
    [33.4418, -114.6245],
    [33.4142, -114.6506],
    [33.4039, -114.7055],
    [33.3546, -114.6973],
    [33.3041, -114.7302],
    [33.2858, -114.7206],
    [33.2754, -114.6808],
    [33.2582, -114.6698],
    [33.2467, -114.6904],
    [33.172, -114.6794],
    [33.0904, -114.7083],
    [33.0858, -114.6918],
    [33.0328, -114.6629],
    [33.0501, -114.6451],
    [33.0305, -114.6286],
    [33.0282, -114.5888],
    [33.0351, -114.575],
    [33.0328, -114.5174],
    [32.9718, -114.4913],
    [32.9764, -114.4775],
    [32.9372, -114.4844],
    [32.8427, -114.4679],
    [32.8161, -114.5091],
    [32.785, -114.5311],
    [32.7573, -114.5284],
    [32.7503, -114.5641],
    [32.7353, -114.6162],
    [32.748, -114.6986],
    [32.7191, -114.722],
    [32.6868, -115.1944],
    [32.5121, -117.3395],
    [32.7838, -117.4823],
    [33.0501, -117.5977],
    [33.2341, -117.6814],
    [33.4578, -118.0591],
    [33.5403, -118.629],
    [33.7928, -118.7073],
    [33.9582, -119.3706],
    [34.1925, -120.005],
    [34.2561, -120.7164],
    [34.536, -120.9128],
    [34.9749, -120.8427],
    [35.2131, -121.1325],
    [35.5255, -121.322],
    [35.9691, -121.8013],
    [36.2808, -122.1446],
    [36.7268, -122.1721],
    [37.2227, -122.6871],
    [37.7783, -122.8903],
    [37.8965, -123.2378],
    [38.3449, -123.3202],
    [38.7423, -123.8338],
    [38.9946, -123.9793],
    [39.3088, -124.0329],
    [39.7642, -124.0823],
    [40.1663, -124.5314],
    [40.4658, -124.6509],
    [41.011, -124.3144],
    [41.2386, -124.3419],
    [41.717, -124.4545],
    [41.9983, -124.4009]
  ]

  # https://stackoverflow.com/a/29915728
  def inside_polygon(point, polygon)
    return false if point.first.blank? || point.last.blank?

    inside = false
    j = polygon.length - 1

    (0..polygon.length - 1).each do |i|
      inside = !inside if intersect?(point, polygon, i, j)
      j = i
    end

    inside
  end

  private

  # rubocop:disable Metrics/AbcSize
  def intersect?(point, polygon, i, j)
    x = point.first
    y = point.last
    xi = polygon[i][0]
    yi = polygon[i][1]
    xj = polygon[j][0]
    yj = polygon[j][1]

    ((yi > y) != (yj > y)) && (x < (xj - xi) * (y - yi) / (yj - yi) + xi)
  end
  # rubocop:enable Metrics/AbcSize
end
